
# Домашнее задание к занятию «Микросервисы: масштабирование»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.

Обоснуйте свой выбор.

## Решение

## Мой выбор: **Kubernetes**

### Поддержка контейнеров
Kubernetes поддерживает контейнеры через Container Runtime Interface (CRI). Поддерживаемые runtime:
- **containerd** (стандартный выбор)
- **CRI-O** (от Red Hat)
- **Docker** (через dockershim, но устарел в новых версиях)

### Обнаружение сервисов и маршрутизация запросов
**Service Discovery:**
- Встроенный **DNS** (CoreDNS) - каждому сервису присваивается доменное имя
- **Service** объекты со статическими IP-адресами
- **Endpoints** для автоматического обновления списка pod'ов

**Маршрутизация:**
- **kube-proxy** и virtual IP для внутренней маршрутизации
- **Ingress Controller** (Nginx, Traefik) для внешнего L7-трафика
- **LoadBalancer** для облачных провайдеров

### Горизонтальное масштабирование
- Увеличение количества **Pod**'ов с контейнерами
- Распределение нагрузки по узлам кластера
- Команда: `kubectl scale deployment --replicas=5`

### Автоматическое масштабирование
**Horizontal Pod Autoscaler (HPA):**
- Автоматическое масштабирование на основе метрик CPU, памяти
- Поддержка custom metrics
- Настройка min/max количества реплик

### Разделение ресурсов
**Namespaces:**
- Логическое разделение кластера на изолированные зоны
- Разделение production/development/staging

**Network Policies:**
- Calico, Cilium для контроля сетевого трафика
- Ограничение доступа между namespace'ами
- Изоляция внутренних и внешних сервисов

**Ingress Controller:**
- Маршрутизация внешнего трафика к внутренним сервисам
- SSL/TLS termination
- Path-based routing

### Конфигурация и безопасное хранение данных
**ConfigMaps:**
- Хранение конфигурационных данных
- Передача через переменные среды или volumes

**Secrets:**
- Безопасное хранение чувствительных данных (пароли, ключи)
- Base64 encoding (не шифрование!)
- Передача через переменные среды или volumes

**External Secrets:**
- **HashiCorp Vault** для продвинутого управления секретами
- **External Secrets Operator** для синхронизации с внешними хранилищами

**Environment Variables:**
- Настройка приложений через переменные среды
- Источники: ConfigMaps, Secrets, прямые значения
